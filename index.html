<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Invent√°rio Pro</title>
    <link rel="stylesheet" href="/static/style_dashboard.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì¶</text></svg>">
</head>
<body>

<div class="dashboard-layout">
    <aside class="sidebar">
        <div class="sidebar-header">
            <i class="icon-box"></i>
            <span class="app-name">Estoque Pro</span>
            <span class="app-sub">Mat√©rias-Primas</span>
        </div>
        <nav class="sidebar-menu">
            <a href="/" class="menu-item active">
                <i class="icon-panel"></i> Painel
            </a>
            <a href="/stock/in/form" class="menu-item">
                <i class="icon-in"></i> Entrada de Estoque
            </a>
            <a href="/?below_threshold=True" class="menu-item alert">
                <i class="icon-control"></i> Controle de Estoque 
                {% if metrics.low_stock_count > 0 %}
                    <span class="menu-alert-badge">{{ metrics.low_stock_count }}</span>
                {% endif %}
            </a>
            <a href="/pedido/form" class="menu-item">
                <i class="icon-integration"></i> Pedido/Baixa Manual
            </a>
            <a href="/report/view" class="menu-item">
                <i class="icon-report"></i> Relat√≥rios
            </a>
        </nav>
        <div class="api-status">
            <span class="status-label">API de status</span>
            <span class="status-indicator online">On-line</span>
        </div>
    </aside>

    <main class="main-content">
        <header class="top-bar">
            <div>
                <h2>Painel de Estoque</h2>
                <p>Controle de materiais primas em tempo real</p>
            </div>
            <div class="header-actions">
                <i class="icon-notification"></i>
                <a href="/report/view" class="btn-exportar">Exportar Relat√≥rio</a>
            </div>
        </header>

        <section class="metrics-grid">
            
            <div class="metric-card total-materials">
                <p class="metric-title">Total de Materiais</p>
                <div class="metric-value">
                    {{ metrics.total_materials }}
                    <i class="icon-box-large"></i>
                </div>
                <p class="metric-info">Materiais cadastrados no sistema</p>
            </div>
            
            <div class="metric-card alerts">
                <p class="metric-title">Alertas de Estoque</p>
                <div class="metric-value alert-red">
                    {{ metrics.low_stock_count }}
                    <i class="icon-alert-large"></i>
                </div>
                <p class="metric-info">Materiais abaixo do estoque m√≠nimo</p>
            </div>
            
            <div class="metric-card pedidos-hoje">
                <p class="metric-title">Pedidos Hoje</p>
                <div class="metric-value success-green">
                    {{ metrics.pedidos_hoje_count }}
                    <i class="icon-cart-large"></i>
                </div>
                <p class="metric-info">Pedidos processados via PedidoOK</p>
            </div>
            
            <div class="metric-card valor-estoque">
                <p class="metric-title">Valor em Estoque</p>
                <div class="metric-value">
                    R$ {{ "{:,.2f}".format(metrics.valor_total_estoque).replace(",", "X").replace(".", ",").replace("X", ".") }}
                    <i class="icon-money-large"></i>
                </div>
                <p class="metric-info">Estimativa baseada no custo m√©dio</p>
            </div>
        </section>

        <section class="visualization-grid">
            <div class="chart-panel stock-levels">
                <h3>N√≠veis de Estoque</h3>
                <p class="chart-subtitle">Hist√≥rico de estoque dos principais materiais (√∫ltimos 7 dias)</p>
                <div class="chart-placeholder">Gr√°fico de N√≠veis de Estoque (Implementa√ß√£o Matplotlib/JS)</div>
            </div>
            
            <div class="chart-panel distribution">
                <h3>Distribui√ß√£o por Categoria</h3>
                <p class="chart-subtitle">Distribui√ß√£o por Categoria (Implementa√ß√£o Matplotlib/JS)</p>
                <div class="chart-placeholder circle-chart">Gr√°fico de Rosca/Pizza</div>
            </div>
        </section>
        
        <section class="inventory-section">
            <h3 class="section-title">Itens em Estoque (Listagem R√°pida)</h3>
            
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome da Mat√©ria-Prima</th>
                        <th class="qty-col">Quantidade Atual</th>
                        <th class="status-col">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in materials %}
                    <tr {% if m.low %} class="low-stock" {% endif %}>
                        <td>{{ m.id }}</td>
                        <td class="material-name-col">{{ m.name }}</td>
                        <td class="qty-col">{{ "{:.2f}".format(m.quantity) }}</td>
                        <td class="status-col">
                            {% if m.low %}
                                <span class="alert-indicator">ALERTA</span>
                            {% else %}
                                <span class="ok-indicator">OK</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            {% if not materials %}
            <p class="empty-state">Nenhum item encontrado no estoque com os filtros atuais.</p>
            {% endif %}
        </section>

    </main>
</div>

</body>
</html>
